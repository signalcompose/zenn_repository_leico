---
title: MidiFileObjectにuassetとして保存する機能を作成する
---

# 工事中

[前回のチャプター](./14)では、`MidiFileObjectFactoryModule` のパス設定を行い、Midiファイルのインポート機能の実装が完了しました。
このチャプターではMidiファイルをuassetとして保存する機能を実装します。

## 処理の流れと実装方針

### uassetに書き出す関数

MidiFileをuassetに書き出すには、 `Serialize` という関数をオーバライドして実装します。
参考: https://historia.co.jp/archives/1457/

この `Serialize` 関数の引数 `FArchive` に書き出すためのデータを渡す必要があります。
渡すデータはUnreal Engineで利用できる型であれば大丈夫そうですので、
入力にも利用した `TArray<uint8>` でMidiのバイナリデータを渡すことにします。
ここを共通の型にしておくことで、uassetからの読み込みに、以前作成した `readMidiFromRawData` を利用することができます。

出口の型が決定したため、次はMidiFileからバイナリデータを書き出す機能を調べます。

### MidiFileからMidiデータを書き出す方法

入力の時に `std :: isteam` を利用したように、MidiFileには `std :: ostream` に書き出す関数が提供されています:
https://github.com/craigsapp/midifile/blob/98917df5b1bf0d6e8d4c0e5fff86d6b05343e793/src/MidiFile.cpp#L572

よって、 `std :: ostream` から `uint8` 配列に変換できれば、 `Serialize` で書き出すことができます。

### `std :: ostream` から配列への変換

https://qiita.com/yumimatoba14/items/c4ac015a09dea2b54bf3
https://cpprefjp.github.io/reference/streambuf/basic_streambuf.html
https://cpprefjp.github.io/reference/ios/basic_ios/rdstate.html


