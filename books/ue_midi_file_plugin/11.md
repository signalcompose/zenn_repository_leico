---
title: Unreal Engineモジュールを作成する
---

[前回のチャプター](/books/ue_midi_file_plugin/10.md)で、モジュールについての解説を行いました。
このチャプターでは、実際にMIDIファイルをインポートするモジュールの作成してみます。

## モジュールの作成

モジュールで利用するフォルダ名と、中のいくつかのソースコード名は関連している必要があります。
今回の解説では、インポートしたMidiファイルを `MidiFileObject` に紐づける、 `MidiFileObjectFactoryModule` という名前のモジュールを作成します。

### 既存のモジュールファイルを流用する

前回のチャプターで解説した通り、既に2つのモジュールを利用しています。モジュール名以外は流用が可能なため、 
今回初 `MidiFilePlugin` フォルダを雛形にしてモジュールを作成します。

まずは `/Plugins/MidiFilePlugin/Source/MidiFilePlugin` フォルダを同じ階層にコピーし、
フォルダ名を `MidiFileObjectFactoryModule` に変更します。

![フォルダをコピーして`MidiFileObjectFactoryModule`に名前変更](/images/books/ue_midi_file_plugin/11/01.gif)
*フォルダをコピーして`MidiFileObjectFactoryModule`に名前変更*

### 不要なコードの削除

`MidiFileObjectFactoryModule` 以下の、前回作成したソースコードを削除します。

![`MidiFileObjectFactoryModule` 内の `MidiFileObject`を削除](/images/books/ue_midi_file_plugin/11/02.gif)
*`MidiFileObjectFactoryModule` 内の `MidiFileObject`を削除*

### ソースコードのファイル名とクラス名の変更

残っている `MidiFilePlugin.cpp`、 `MidiFilePlugin.h` のファイル名を、
それぞれ `MidiFileObjectFactoryModule.cpp`、 `MidiFileObjectFactoryModule.h` に変更します。

![ソースコードのファイル名を変更](/images/books/ue_midi_file_plugin/11/03.gif)
*ソースコードのファイル名を変更*

また、内部の関連項目の名称も変更します。

#### `MidiFileObjectFactoryModule.h`

```cpp
#pragma once

#include "Modules/ModuleManager.h"

class FMidiFileObjectFactoryModule/*変更*/ : public IModuleInterface
{
public:

	/** IModuleInterface implementation */
	virtual void StartupModule() override;
	virtual void ShutdownModule() override;
};
```

#### `MidiFileObjectFactoryModule.cpp`

```cpp
#include "MidiFileObjectFactoryModule.h" //変更

#define LOCTEXT_NAMESPACE "FMidiFileObjectFactoryModule"//変更

void FMidiFileObjectFactoryModule/*変更*/::StartupModule()
{
	// This code will execute after your module is loaded into memory; the exact timing is specified in the .uplugin file per-module
}

void FMidiFileObjectFactoryModule/*変更*/::ShutdownModule()
{
	// This function may be called during shutdown to clean up your module.  For modules that support dynamic reloading,
	// we call this function before unloading the module.
}

#undef LOCTEXT_NAMESPACE
	
IMPLEMENT_MODULE(FMidiFileObjectFactoryModule/*変更*/, MidiFileObjectFactoryModule/*変更*/) 
```

これらクラスは通例で名前が `F(モジュール名)` となっています。

### `MidiFileObjectFactoryModule.Build.cs` の変更

`Build.cs` も修正が必要です。まずは名前を `MidiFileObjectFactoryModule.Build.cs` に修正します。

![ファイル名の変更](/images/books/ue_midi_file_plugin/11/04.gif)
*ファイル名の変更*

こちらもソースコード内の対応する場所を修正します。

```cs
using UnrealBuildTool;

public class MidiFileObjectFactoryModule/*変更*/ : ModuleRules
{
	public MidiFileObjectFactoryModule(ReadOnlyTargetRules Target)/*変更*/ : base(Target)
	{
		PCHUsage = ModuleRules.PCHUsageMode.UseExplicitOrSharedPCHs;

...省略	
```

## プラグイン設定の変更

最後に、 `MidiFilePlugin.uasset` 内の `Modules` に `MidiFileObjectFactoryModule` の設定を追加します。
`MidiFilePlugin.uasset` は `/Plugins/MidiFilePlugin` にあります。

![]()

```json
...省略
	"Modules": [
		{
			"Name": "MidiFilePlugin",
			"Type": "Runtime",
			"LoadingPhase": "Default"
		},
        //以下を追加
		{
			"Name": "MidiFileObjectFactoryModule",
			"Type": "Editor",
			"LoadingPhase": "Default"
		}
	]
...省略
```

## Visual Studioプロジェクトの再生成

[以前のチャプターで紹介した方法](/books/ue_midi_file_plugin/02.md)で、プロジェクトファイルの再生成を行います。