---
title: MidiFilePluginBlueprintModuleとMidiFileSequenceModuleを作成する
---

# 工事中

[前回のチャプター](./16) では、BlueprintノードとC++クラス関数の関係や、
Blueprint上でインスタンスを扱う上での注意、主にガベージコレクションに関する問題をまとめました。

このチャプターでは、Blueprintノード用のクラスを実装する2つのモジュールを作成します。

## モジュールの作成方法のおさらい

Unreal Engineにおけるモジュールに関する情報は [チャプター10](./10) で、
また、実際にモジュールを作成する作業は [チャプター11](./11) で一度行いました。
今回もこちらと同じように、 `MidiFileObjectFactoryModule` のビルド設定などを流用しながら進めます。

## `MidiFilePluginBlueprintModule` の作成 

1. `MidiFileObjectFactoryModule` フォルダをコピーし、 `MidiFilePluginBlueprintModule` という名前に変更します
2. `MidiFilePluginBluePrintModule` 内部の `Public/MidiFileObjectFactoryModule.h` と `Private/MidiFileObjectFactoryModule.cpp` 以外のファイルを削除します
3. フォルダ内にあるそれぞれのファイル名を変更します
   1. `MidiFileObjectFactoryModule.Build.cs` -> `MidiFilePluginBlueprintModule.Build.cs`
   2. `MidiFileObjectFactoryModule.h`        -> `MidiFilePluginBlueprintModule.h`
   3. `MidiFileObjectFactoryModule.cpp`      -> `MidiFilePluginBlueprintModule.cpp`
4. 以下のように、それぞれファイルの中身を更新します

### `MidiFilePluginBlueprintModule.Build.cs`

```diff cs
using UnrealBuildTool;

+ public class MidiFilePluginBlueprintModule : ModuleRules
{
+ 	public MidiFilePluginBlueprintModule(ReadOnlyTargetRules Target) : base(Target)
	{
		PCHUsage = ModuleRules.PCHUsageMode.UseExplicitOrSharedPCHs;

		PublicIncludePaths.AddRange(
			new string[] {
				// ... add public include paths required here ...
				"$(PluginDir)/Source/MidiFilePlugin/Public"
			}
			);
		PrivateIncludePaths.AddRange(
			new string[] {
				// ... add other private include paths required here ...
			}
			);
		PublicDependencyModuleNames.AddRange(
			new string[]
			{
				"Core",
				"MidiFile",

				"MidiFilePlugin",
				// ... add other public dependencies that you statically link with here ...
			}
			);
		PrivateDependencyModuleNames.AddRange(
			new string[]
			{
				"CoreUObject",
				"Engine",
				"Slate",
				"SlateCore",
-				"UnrealEd" //削除
				// ... add private dependencies that you statically link with here ...	
			}
			);
		DynamicallyLoadedModuleNames.AddRange(
			new string[]
			{
				// ... add any modules that your module loads dynamically here ...
			}
			);
	}
}
```

### MidiFilePluginBlueprintModule.h

```diff cpp
#pragma once

#include "Modules/ModuleManager.h"

+ class FMidiFilePluginBlueprintModule : public IModuleInterface //クラス名変更
{
public:

	/** IModuleInterface implementation */
	virtual void StartupModule() override;
	virtual void ShutdownModule() override;
};
```

### MidiFilePluginBlueprintModule.cpp

```diff cpp
+ #include "MidiFilePluginBlueprintModule.h" //ファイル名変更

+ #define LOCTEXT_NAMESPACE "FMidiFilePluginBlueprintModule" //文字列変更

+ void FMidiFilePluginBlueprintModule::StartupModule() //クラス名変更
{
	// This code will execute after your module is loaded into memory; the exact timing is specified in the .uplugin file per-module
}

+ void FMidiFilePluginBlueprintModule::ShutdownModule() //クラス名変更
{
	// This function may be called during shutdown to clean up your module.  For modules that support dynamic reloading,
	// we call this function before unloading the module.
}

#undef LOCTEXT_NAMESPACE
	
+ IMPLEMENT_MODULE(FMidiFilePluginBlueprintModule, MidiFilePluginBlueprintModule) // 変数2つとも名称変更
```

### MidiFilePlugin.uplugin

```diff json
{
  "FileVersion": 3,
  "Version": 1,
  "VersionName": "1.0",
  "Modules": [
    {
      "Name": "MidiFilePlugin",
      "Type": "Runtime",
      "LoadingPhase": "Default"
    },
    {
      "Name": "MidiFileObjectFactoryModule",
      "Type": "Editor",
      "LoadingPhase": "Default"
+    }, // コンマ追加
+    {
+      "Name": "MidiFilePluginBlueprintModule",
+      "Type": "Runtime",
+      "LoadingPhase": "Default"
+    }
  ],
  "FriendlyName": "MidiFilePlugin",
  "Description": "",
  "Category": "Other",
  "CreatedBy": "",
  "CreatedByURL": "",
  "DocsURL": "",
  "MarketplaceURL": "",
  "SupportURL": "",
  "CanContainContent": "true",
  "Installed": false,
  "IsBetaVersion": false,
  "Plugins": [],
  "SupportedTargetPlatforms": null
}
```

ここまでの修正を行い、ビルドが通るか一度確認します。